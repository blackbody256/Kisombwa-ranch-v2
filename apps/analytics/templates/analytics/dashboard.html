<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KRIS Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f5f7f9; }
    .kpi-card { border: 0; box-shadow: 0 1px 8px rgba(0,0,0,0.08); }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">Kisombwa Ranch Intelligence System</h1>
      <a href="/api/analytics/dashboard/" class="btn btn-outline-dark btn-sm">JSON API</a>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card kpi-card"><div class="card-body"><div class="text-muted small">Total Animals</div><div class="display-6">{{ kpis.total_animals }}</div></div></div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card"><div class="card-body"><div class="text-muted small">Active Animals</div><div class="display-6">{{ kpis.active_animals }}</div></div></div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card"><div class="card-body"><div class="text-muted small">Overdue Vaccinations</div><div class="display-6">{{ kpis.overdue_vaccinations }}</div></div></div>
      </div>
      <div class="col-md-3">
        <div class="card kpi-card"><div class="card-body"><div class="text-muted small">Mortality (30 days)</div><div class="display-6">{{ kpis.recent_mortality_30_days }}</div></div></div>
      </div>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-lg-6">
        <div class="card kpi-card">
          <div class="card-header">Animals by Species</div>
          <div class="card-body">
            <table class="table table-sm mb-0">
              <thead><tr><th>Species</th><th class="text-end">Total</th></tr></thead>
              <tbody>
              {% for row in animals_by_species %}
                <tr><td>{{ row.species }}</td><td class="text-end">{{ row.total }}</td></tr>
              {% empty %}
                <tr><td colspan="2" class="text-center text-muted">No data</td></tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card kpi-card">
          <div class="card-header">Breeding Performance by Source</div>
          <div class="card-body">
            <table class="table table-sm mb-0">
              <thead><tr><th>Source</th><th class="text-end">Events</th><th class="text-end">Conceived</th><th class="text-end">Rate</th></tr></thead>
              <tbody>
              {% for row in breeding_by_source %}
                <tr>
                  <td>{{ row.source }}</td>
                  <td class="text-end">{{ row.total_events }}</td>
                  <td class="text-end">{{ row.conceived }}</td>
                  <td class="text-end">{{ row.conception_rate }}%</td>
                </tr>
              {% empty %}
                <tr><td colspan="4" class="text-center text-muted">No data</td></tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-lg-6">
        <div class="card kpi-card">
          <div class="card-header">Vaccination vs Conception</div>
          <div class="card-body">
            <p class="mb-1">Complete vaccination: <strong>{{ vaccination_correlation.complete_vaccination.conception_rate }}%</strong> ({{ vaccination_correlation.complete_vaccination.total_events }} events)</p>
            <p class="mb-0">Incomplete vaccination: <strong>{{ vaccination_correlation.incomplete_vaccination.conception_rate }}%</strong> ({{ vaccination_correlation.incomplete_vaccination.total_events }} events)</p>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card kpi-card">
          <div class="card-header">Recent Mortality</div>
          <ul class="list-group list-group-flush">
            {% for item in recent.mortality %}
              <li class="list-group-item d-flex justify-content-between"><span>{{ item.animal_tag_id }}</span><span>{{ item.death_date }}</span></li>
            {% empty %}
              <li class="list-group-item text-muted">No recent mortality events</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
